
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>23. Nested functions Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="24-Trampolines.html" />
    
    
    <link rel="prev" href="22-The-Thumb-instruction-set.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Learning Assembly Language with ARM
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="1-Introduction.html">
            
                <a href="1-Introduction.html">
            
                    
                    1. Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="2-Registers-and-Basic-arithmetic.html">
            
                <a href="2-Registers-and-Basic-arithmetic.html">
            
                    
                    2. Registers and Basic arithmetic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="3-Memory-addreses-Load-and-store.html">
            
                <a href="3-Memory-addreses-Load-and-store.html">
            
                    
                    3. Memory, addreses, Load and store
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="4-GDB.html">
            
                <a href="4-GDB.html">
            
                    
                    4. GDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="5-Branches.html">
            
                <a href="5-Branches.html">
            
                    
                    5. Branches
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="6-Control-Structures.html">
            
                <a href="6-Control-Structures.html">
            
                    
                    6. Control Structures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="7-Indexing-modes.html">
            
                <a href="7-Indexing-modes.html">
            
                    
                    7. Indexing modes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="8-Arrays-and-structures.html">
            
                <a href="8-Arrays-and-structures.html">
            
                    
                    8. Arrays and structures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="9-Functions-1.html">
            
                <a href="9-Functions-1.html">
            
                    
                    9. Functions-1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="10-Functions-2-The-stack.html">
            
                <a href="10-Functions-2-The-stack.html">
            
                    
                    10. Functions-2 The stack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11" data-path="11-Predication.html">
            
                <a href="11-Predication.html">
            
                    
                    11. Predication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.12" data-path="12-Loops-and-the-status-register.html">
            
                <a href="12-Loops-and-the-status-register.html">
            
                    
                    12. Loops and the status register
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.13" data-path="13-Floating-point-numbers.html">
            
                <a href="13-Floating-point-numbers.html">
            
                    
                    13. Floating point numbers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.14" data-path="14-Matrix-multiply.html">
            
                <a href="14-Matrix-multiply.html">
            
                    
                    14. Matrix multiply
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.15" data-path="15-Integer-division.html">
            
                <a href="15-Integer-division.html">
            
                    
                    15. Integer division
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.16" data-path="16-Switch-control-structure.html">
            
                <a href="16-Switch-control-structure.html">
            
                    
                    16. Switch control structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.17" data-path="17-Passing-data-to-functions.html">
            
                <a href="17-Passing-data-to-functions.html">
            
                    
                    17. Passing data to functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.18" data-path="18-Local-data-and-the-frame-pointer.html">
            
                <a href="18-Local-data-and-the-frame-pointer.html">
            
                    
                    18. Local data and the frame pointer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.19" data-path="19-System-calls.html">
            
                <a href="19-System-calls.html">
            
                    
                    19. System calls
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.20" data-path="20-Indirect-calls.html">
            
                <a href="20-Indirect-calls.html">
            
                    
                    20. Indirect calls
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.21" data-path="21-Subword-data.html">
            
                <a href="21-Subword-data.html">
            
                    
                    21. Subword data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.22" data-path="22-The-Thumb-instruction-set.html">
            
                <a href="22-The-Thumb-instruction-set.html">
            
                    
                    22. The Thumb instruction set
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.23" data-path="23-Nested-functions.html">
            
                <a href="23-Nested-functions.html">
            
                    
                    23. Nested functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.24" data-path="24-Trampolines.html">
            
                <a href="24-Trampolines.html">
            
                    
                    24. Trampolines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.25" data-path="25-Integer-SIMD.html">
            
                <a href="25-Integer-SIMD.html">
            
                    
                    25. Integer SIMD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.26" data-path="26-A-primer-about-linking.html">
            
                <a href="26-A-primer-about-linking.html">
            
                    
                    26. A primer about linking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.27" data-path="27-dynamic-linking.html">
            
                <a href="27-dynamic-linking.html">
            
                    
                    27. dynamic-linking
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="appendix.html">
            
                <a href="appendix.html">
            
                    
                    Appendix
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >23. Nested functions</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="23-nested-functions">23. Nested functions</h1>
<hr>
<p>Nested function &#xC740; &#xD568;&#xC218; &#xB0B4;&#xBD80;&#xC5D0; &#xC815;&#xC758;&#xB41C; &#xD568;&#xC218;&#xC774;&#xB2E4;. &#xD568;&#xC218; &#xB0B4;&#xBD80;&#xC5D0;&#xC11C;&#xB9CC; &#xC0AC;&#xC6A9;&#xAC00;&#xB2A5;&#xD558;&#xB2E4;. &#xB9C8;&#xCE58; &#xB85C;&#xCEEC;&#xBCC0;&#xC218; &#xCC98;&#xB7FC; lifetime&#xC774; &#xD568;&#xC218;&#xC640; &#xB3D9;&#xC77C;&#xD558;&#xB2E4;.  </p>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">E</span><span class="hljs-params">(<span class="hljs-keyword">float</span> x)</span>
</span>{
    <span class="hljs-function"><span class="hljs-keyword">float</span> <span class="hljs-title">F</span><span class="hljs-params">(<span class="hljs-keyword">float</span> y)</span>
    </span>{
        <span class="hljs-keyword">return</span> x + y;
    }
    <span class="hljs-keyword">return</span> F(<span class="hljs-number">3</span>) + F(<span class="hljs-number">4</span>);
}
</code></pre>
<blockquote>
<p>F()&#xB294; &#xD568;&#xC218;E() &#xC548;&#xC5D0; &#xC788;&#xB294; &#xD568;&#xC218;&#xC778;&#xB370;, &#xADF8; scope&#xAC00; &#xD568;&#xC218;E()&#xC640; &#xB3D9;&#xC77C;&#xD558;&#xB2E4;. </p>
</blockquote>
<h2 id="nested-function-for-assembler-level">Nested function for assembler level</h2>
<p>&#xAE30;&#xBCF8;&#xC801;&#xC73C;&#xB85C; Assembler &#xB808;&#xBCA8;&#xC5D0;&#xC11C;&#xB294; &#xD568;&#xC218;&#xB294; Nested&#xB420; &#xC218; &#xC5C6;&#xB2E4;. (<del>&#xC0AC;&#xC2E4; &#xB530;&#xC9C0;&#xACE0; &#xBCF4;&#xBA74; &#xD568;&#xC218;&#xB77C;&#xB294;&#xAC83;&#xB3C4; &#xC874;&#xC7AC;&#xD558;&#xC9C0; &#xC54A;&#xB294;&#xB2E4;</del>) &#xD568;&#xC218;&#xB294; Calling Convention(AAPCS) &#xACFC; &#xD568;&#xAED8; &#xB17C;&#xB9AC;&#xC801;&#xC73C;&#xB85C; &#xC874;&#xC7AC;&#xD560; &#xBFD0;&#xC774;&#xB2E4;.  Assembler &#xB808;&#xBCA8;&#xC5D0;&#xC11C;&#xB294; &#xBAA8;&#xB4E0;&#xAC83;&#xC740; &#xB370;&#xC774;&#xD130;&#xB098; &#xBA85;&#xB839;&#xC5B4; &#xC544;&#xB2C8;&#xBA74; &#xC8FC;&#xC18C;&#xC774;&#xB2E4;. </p>
<p>Assembler &#xB808;&#xBCA8;&#xC5D0;&#xC11C; Nested Function&#xC758; &#xC758;&#xBBF8;&#xB294; Dynamic Activate &#xBC94;&#xC704; &#xB0B4; &#xC5D0;&#xC11C;&#xB9CC; &#xC874;&#xC7AC;(life tiem&#xC744; &#xAC19;&#xC774;&#xD558;&#xB294;)&#xD558;&#xB294; &#xD568;&#xC218;&#xB97C; &#xC758;&#xBBF8;&#xD55C;&#xB2E4;. </p>
<h2 id="dynamic-link">Dynamic link</h2>
<p>Dynamic link &#xB780;?<br>The dynamic link is set at the beginning of the function and we use the fp register (an alias for r11) to keep an address in the stack usually called the frame pointer.  </p>
<p>frame pointer&#xB97C; &#xC774;&#xC6A9;&#xD558;&#xBA74; dynamic activation &#xB0B4;&#xC758; &#xB85C;&#xCEEC;&#xBCC0;&#xC218;&#xB97C; &#xC77C;&#xAD00;&#xB418;&#xAC8C; &#xC5D1;&#xC138;&#xC2A4;&#xD560; &#xC218; &#xC788;&#xB2E4;. &#xB85C;&#xCEEC;&#xBCC0;&#xC218;&#xB294; <code>fp</code>&#xB85C;&#xBD80;&#xD130; (-)offset, &#xC804;&#xB2EC;&#xBC1B;&#xC740; parameter&#xB294; (+)offset &#xC73C;&#xB85C; &#xC5BB;&#xC744; &#xC218; &#xC788;&#xB2E4;. &#xC544;&#xB798; &#xADF8;&#xB9BC;&#xC5D0;&#xC11C; activation record &#xAC00; &#xC2A4;&#xD0DD;&#xC5D0; &#xC5B4;&#xB5BB;&#xAC8C; &#xC313;&#xC774;&#xB294;&#xC9C0; &#xBCF4;&#xC5EC;&#xC900;&#xB2E4;.<br>(&#xB9AC;&#xB205;&#xC2A4; ARM&#xC5D0;&#xC11C;&#xB294; &#xB0AE;&#xC740; &#xC8FC;&#xC18C; &#xBC29;&#xD5A5;&#xC73C;&#xB85C; &#xC2A4;&#xD0DD; &#xC0AC;&#xC774;&#xC988;&#xAC00; &#xCEE4;&#xC9C4;&#xB2E4;&#xB294;&#xAC83;&#xC744; &#xD56D;&#xC0C1; &#xC720;&#xC758;)</p>
<p><img src="https://thinkingeek.com/wp-content/uploads/2015/01/activation_record.png" alt="activation record"></p>
<h2 id="static-link">Static link</h2>
<p>&#xAC00;&#xC815;&#xD574;&#xBCF4;&#xC790;, &#xC704;&#xC758; &#xADF8;&#xB9BC;&#xC5D0;&#xC11C; &#xD568;&#xC218; g&#xAC00; &#xD568;&#xC218; f&#xC758; Nested function&#xC774;&#xB77C;&#xBA74;? &#xD568;&#xC218; g&#xB294; f&#xC758; &#xB85C;&#xCEEC;&#xBCC0;&#xC218;&#xB97C; Access&#xD560; &#xC218; &#xC788;&#xC5B4;&#xC57C;&#xD55C;&#xB2E4;. &#xADF8;&#xAC83;&#xC740; previous fp&#xB97C; &#xC5BB;&#xC74C;&#xC73C;&#xB85C;&#xC368; &#xAC00;&#xB2A5;&#xD558;&#xB2E4;.<br>&#xACB0;&#xAD6D;, &#xC774; &#xC7A5;&#xC5D0;&#xC11C; &#xC6B0;&#xB9AC;&#xC758; &#xCD5C;&#xC885; &#xAD00;&#xC2EC;&#xC0AC;&#xB294; &#xC5B4;&#xB5BB;&#xAC8C; Caller&#xD568;&#xC218;&#xC758; &#xB85C;&#xCEEC; &#xBCC0;&#xC218;&#xB97C; Nedted&#xD568;&#xC218;&#xC5D0;&#xC11C; Access&#xD560;&#xC218; &#xC788;&#xB294;&#xAC00;&#xC774;&#xB2E4;.  </p>
<p>&#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; C nested &#xD568;&#xC218;&#xAC00; &#xC788;&#xB2E4;&#xACE0; &#xD558;&#xC790;. &#xADF8;&#xB9BC;&#xCC98;&#xB7FC; &#xD568;&#xC218; g()&#xAC00; &#xD568;&#xC218; f()&#xC758; Nested function &#xC774;&#xB2E4;.  </p>
<h4 id="&#xC608;&#xC81C;-1">&#xC608;&#xC81C; 1</h4>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> <span class="hljs-comment">// non-nested (normal) function</span>
</span>{
    <span class="hljs-keyword">int</span> x;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">g</span><span class="hljs-params">()</span>     <span class="hljs-comment">// nested function</span>
    </span>{
      x = x + <span class="hljs-number">1</span>; <span class="hljs-comment">// x &#x2190;  x + 1</span>
    }

    x = <span class="hljs-number">1</span>;       <span class="hljs-comment">// x &#x2190;  1</span>
    g();         <span class="hljs-comment">// call g</span>
    x = x + <span class="hljs-number">1</span>;   <span class="hljs-comment">// x &#x2190;  x + 1</span>

}
</code></pre>
<blockquote>
<p>&#xCD5C;&#xC885; x &#xB294; 3&#xC774; &#xB420;&#xAC83;&#xC774;&#xB2E4;.<br>Nested function g()&#xC5D0;&#xC11C; f()&#xC758; &#xB85C;&#xCEEC;&#xBCC0;&#xC218; x&#xB97C; &#xC811;&#xADFC;&#xD574;&#xC11C; &#xC0AC;&#xC6A9;&#xD588;&#xB2E4;.  </p>
</blockquote>
<p>&#xC5B4;&#xC148;&#xBE14;&#xB9AC; &#xB808;&#xBCA8;&#xC5D0;&#xC11C; g()&#xAC00; f()&#xC758; &#xB85C;&#xCEEC;&#xBCC0;&#xC218; x&#xB97C; &#xC5B4;&#xB5BB;&#xAC8C; Access&#xD560; &#xC218; &#xC788;&#xC744;&#xAE4C;? g()&#xD568;&#xC218;&#xC5D0;&#xC11C; &#xC774;&#xC804;&#xC758; frame pointer &#xC989;, &#xD568;&#xC218; f()&#xC758; <code>fp</code>&#xB97C; &#xC5BB;&#xC5B4;&#xC57C;&#xD55C;&#xB2E4;.  </p>
<pre><code class="lang-asm">.text

f:
    push {r4, r5, fp, lr} /* keep registers */
    mov fp, sp /* keep dynamic link */

    sub sp, sp, #8      /* make room for x (4 bytes)
                           plus 4 bytes to keep stack
                           aligned */
    /* x is in address &quot;fp - 4&quot; */

    mov r4, #0          /* r4 &#x2190;  0 */
    str r4, [fp, #-4]   /* x &#x2190;  r4 */

    bl g                /* call (nested function) g
                           (the code of &apos;g&apos; is given below, after &apos;f&apos;) */

    ldr r4, [fp, #-4]   /* r4 &#x2190;  x */
    add r4, r4, #1      /* r4 &#x2190;  r4 + 1 */
    str r4, [fp, #-4]   /* x &#x2190;  r4 */

    mov sp, fp /* restore dynamic link */
    pop {r4, r5, fp, lr} /* restore registers */
    bx lr /* return */

    /* nested function g */
    g:
        push {r4, r5, fp, lr} /* keep registers */
        mov fp, sp /* keep dynamic link */

        /* At this point our stack looks like this

          Data | Address | Notes
         ------+---------+--------------------------
           r4  | fp      |  
           r5  | fp + 4  |
           fp  | fp + 8  | This is the previous fp
                           ^^^^^^^^^^^^^^^^^^^^^^^
           lr  | fp + 16 |
        */

        ldr r4, [fp, #+8] /* get the frame pointer of my caller (since only f can call me) */
        ^^^^^^^^^^^^^^^^^
        /* now r4 acts like the fp we had inside &apos;f&apos; */
        ldr r5, [r4, #-4] /* r5 &#x2190;  x */
        add r5, r5, #1    /* r5 &#x2190;  r5 + 1 */
        str r5, [r4, #-4] /* x &#x2190;  r5 */

        mov sp, fp /* restore dynamic link */
        pop {r4, r5, fp, lr} /* restore registers */
        bx lr /* return */

.globl main

main :
    push {r4, lr} /* keep registers */

    bl f          /* call f */

    mov r0, #0
    pop {r4, lr}
    bx lr
</code></pre>
<blockquote>
<ul>
<li>&#xD568;&#xC218; g &#xC758; Activation Record &#xB0B4;&#xC5D0;&#xC788;&#xB294; &#xBCF4;&#xC874;&#xB41C; &#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB4E4; &#xC911; &#xD558;&#xB098;&#xAC00; caller&#xD568;&#xC218; f&#xC758; <code>fp</code> &#xB97C; &#xAC00;&#xC9C0;&#xACE0; &#xC788;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; fp&#xC5D0;&#xC11C; (+)offset&#xC744; &#xD1B5;&#xD574; previous fp&#xB97C; &#xC5BB;&#xC744; &#xC218; &#xC788;&#xB2E4;. (&#xC774;&#xAC83;&#xC740; &#xB9C8;&#xCE58; caller&#xAC00; &#xC804;&#xB2EC;&#xD55C; parameter&#xB97C; &#xC5BB;&#xB294; &#xAC83;&#xACFC; &#xB3D9;&#xC77C;&#xD558;&#xB2E4;) &#xB530;&#xB85C; stack operation(push/pop)&#xC744; &#xD1B5;&#xD574; &#xC774;&#xC804; fp&#xB97C; &#xC5BB;&#xC5B4; &#xB0BC; &#xD544;&#xC694;&#xAC00; &#xC5C6;&#xB2E4;&#xB294; &#xB73B;&#xC774;&#xB2E4;.   </li>
<li><code>ldr r4, [fp, #+8]</code> : [fp, #+8] &#xC774; &#xBC14;&#xB85C; &#xC774;&#xC804; fp&#xAC00; &#xBCF4;&#xC874;&#xB41C; &#xC2A4;&#xD0DD;&#xC758; &#xC8FC;&#xC18C;(&#xAC00; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xAC12;)&#xC774;&#xB2E4;.  </li>
<li>&#xB530;&#xB77C;&#xC11C; f()&#xC758; <code>fp</code>&#xB97C; &#xC5BB;&#xC5C8;&#xC73C;&#xBBC0;&#xB85C; f()&#xC758; &#xB85C;&#xCEEC;&#xBCC0;&#xC218;&#xB294; <code>fp</code>&#xC758; (-)offset&#xC744; &#xD1B5;&#xD574; &#xC5BB;&#xC5B4;&#xB0BC;&#xC218; &#xC788;&#xB2E4;.  </li>
<li><code>ldr r5, [r4, #-4]</code> : [r4, #-4] &#xAC00; &#xBC14;&#xB85C; local&#xBCC0;&#xC218; x &#xC758; &#xC8FC;&#xC18C;(&#xAC00; &#xAC00;&#xB9AC;&#xD0A4;&#xB294; &#xAC12;)&#xC774;&#xB2E4;.  </li>
</ul>
</blockquote>
<p>&#xC704;&#xC758; &#xC608;&#xC81C;&#xC5D0;&#xC11C;&#xB294; &#xD568;&#xC218; g()&#xC5D0;&#xC11C; &#xD604;&#xC7AC;<code>fp</code>&#xC5D0;&#xC11C; &#xC9C1;&#xC811; offset &#xC744; &#xACC4;&#xC0B0;&#xD574; caller&#xC758; <code>fp</code>&#xB97C; &#xC5BB;&#xC5B4;&#xC654;&#xB2E4;. &#xD558;&#xC9C0;&#xB9CC; &#xC774; &#xBC29;&#xC2DD;&#xC5D0;&#xB294; &#xBA85;&#xD655;&#xD55C; &#xD55C;&#xACC4;&#xAC00; &#xC788;&#xB2E4;. Nested function call&#xC744; &#xD55C;&#xBC88;&#xBC16;&#xC5D0; &#xBABB;&#xD55C;&#xB2E4;&#xB294; &#xAC83;&#xC774;&#xB2E4;!! &#xB610;&#xB2E4;&#xB978; nested &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xC9C0; &#xBABB;&#xD560; &#xBFD0;&#xB354;&#xB7EC;, &#xD568;&#xC218;&#xB97C; &#xC7AC;&#xADC0;&#xC801;&#xC73C;&#xB85C; &#xD638;&#xCD9C; &#xD560; &#xC218;&#xB3C4; &#xC5C6;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; &#xD638;&#xCD9C;&#xB41C; &#xD568;&#xC218; &#xB0B4;&#xC5D0;&#xC11C; Frame pointer&#xB97C; &#xC9C1;&#xC811; &#xC774;&#xC6A9;&#xD558;&#xB294; &#xBC29;&#xBC95;&#xC740; &#xD55C;&#xACC4;&#xAC00; &#xC788;&#xB2E4;.  </p>
<p>&#xB530;&#xB77C;&#xC11C; &#xD56D;&#xC0C1; nested&#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD55C; &#xC774;&#xC804;&#xD568;&#xC218;&#xC758; Activation &#xC744; &#xC5BB;&#xC5B4;&#xC640;&#xC57C; &#xD55C;&#xB2E4;. &#xC774; &#xBC29;&#xC2DD;&#xC744; <strong>Static Link</strong>&#xB77C;&#xACE0; &#xBD80;&#xB978;&#xB2E4;.
&#xC989; Static Link&#xB294; &#xC2E4;&#xC81C; nested&#xD568;&#xC218;&#xAC00; &#xAD6C;&#xD604;&#xB41C;, enclosing&#xB41C; &#xD568;&#xC218;&#xC758; <code>fp</code> &#xB97C; &#xC758;&#xBBF8;&#xD55C;&#xB2E4;. &#xB2E8;&#xC21C;&#xC774; caller&#xC758; <code>fp</code>&#xAC00; &#xC544;&#xB2C8;&#xB2E4;.<br>Static Link&#xC758; &#xAC1C;&#xB150;&#xC740; &#xAC04;&#xB2E8;&#xD558;&#xB2E4;. &#xC11C;&#xB85C; &#xC5F0;&#xACB0;&#xB41C; frame pointer&#xC758; &#xCCB4;&#xC778;&#xC774;&#xB2E4;. Static Link&#xB294; &#xC5B4;&#xB5A4; &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB418;&#xB290;&#xB0D0;&#xC5D0; &#xB530;&#xB77C; &#xC11C;&#xB85C; &#xB2E4;&#xB974;&#xAC8C; &#xC124;&#xC815;&#xC774; &#xB420; &#xC218; &#xC788;&#xB2E4;. &#xADF8;&#xB9AC;&#xACE0; &#xADF8; &#xC124;&#xC815;&#xC740; Caller&#xAC00; &#xD55C;&#xB2E4;.  &#xB2E4;&#xC74C; &#xC77C;&#xB828;&#xC758; Assembly &#xC608;&#xC81C;&#xB4E4;&#xC744; &#xBCF4;&#xBA74; &#xBB34;&#xC2A8;&#xB9D0;&#xC778;&#xC9C0; &#xB354; &#xBA85;&#xD655;&#xD558;&#xAC8C; &#xC774;&#xD574;&#xD560; &#xC218; &#xC788;&#xB2E4;.  </p>
<p>&#xB2E4;&#xC74C;&#xACFC; &#xAC19;&#xC740; &#xC911;&#xCCA9;&#xB41C; nested function &#xC744; &#xBCF4;&#xC790;.   </p>
<h4 id="&#xC608;&#xC81C;-2">&#xC608;&#xC81C; 2</h4>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> <span class="hljs-comment">// non nested (nesting depth = 0)</span>
</span>{
   <span class="hljs-keyword">int</span> x;

   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">g</span><span class="hljs-params">()</span> <span class="hljs-comment">// nested (nesting depth = 1)</span>
   </span>{
      x = x + <span class="hljs-number">1</span>; <span class="hljs-comment">// x &#x2190;  x + 1</span>
   }
   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">h</span><span class="hljs-params">()</span> <span class="hljs-comment">// nested (nesting depth = 1)</span>
   </span>{
      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">m</span><span class="hljs-params">()</span> <span class="hljs-comment">// nested (nesting depth = 2)</span>
      </span>{
         x = x + <span class="hljs-number">2</span>; <span class="hljs-comment">// x &#x2190;  x + 2</span>
         g(); <span class="hljs-comment">// call g</span>
      }

      g(); <span class="hljs-comment">// call g</span>
      m(); <span class="hljs-comment">// call m</span>
      x = x + <span class="hljs-number">3</span>; <span class="hljs-comment">// x &#x2190;  x + 3</span>
   }

   x = <span class="hljs-number">1</span>; <span class="hljs-comment">// x &#x2190;  1</span>
   h();  <span class="hljs-comment">// call h</span>
}
</code></pre>
<blockquote>
<p>&#xACB0;&#xACFC;&#xB294; x &#xB294; 8&#xC774; &#xB420;&#xAC83;&#xC774;&#xB2E4;.<br>h &#xC640; g&#xB294; f&#xC5D0;&#xC758;&#xD574; &#xB458;&#xB7EC;&#xC313;&#xC774;&#xAC8C;(enclosing)&#xB41C;&#xB2E4;.<br>m&#xC740; h&#xC5D0;&#xC758;&#xD574; &#xB458;&#xB7EC;&#xC313;&#xC774;&#xAC8C;(enclosing)&#xB41C;&#xB2E4;.<br>m&#xC774; g&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB354;&#xB77C;&#xB3C4; g&#xC758; static link&#xB294; m&#xC774; &#xC544;&#xB2C8;&#xB2E4;. g&#xAC00; &#xC5B4;&#xB514;&#xC11C; &#xD638;&#xCD9C;&#xB418;&#xB358; &#xAC04;&#xC5D0; g&#xC758; static link&#xB294; f&#xC784;&#xC744; &#xC8FC;&#xC758;.<br>g&#xB294; f&#xC5D0; &#xC758;&#xD574; enclosing&#xB418;&#xC5C8;&#xAE30; &#xB54C;&#xBB38;&#xC774;&#xB2E4;.   </p>
</blockquote>
<p>&#xB354;&#xC6B1; &#xAC04;&#xB2E8;&#xD788; &#xD45C;&#xD604; &#xD558;&#xBA74; &#xC544;&#xB798;&#xC640; &#xAC19;&#xB2E4;.  </p>
<pre><code class="lang-asm">f {
        g { }           // f &#xB97C; &#xAC00;&#xB9AC;&#xD0B4;
        h {             // f &#xB97C; &#xAC00;&#xB9AC;&#xD0B4;
                m { }   // h &#xB97C; &#xAC00;&#xB9AC;&#xD0B4;
           }
}
</code></pre>
<h2 id="setting-up-a-static-link">Setting up a static link</h2>
<p>AAPCS&#xB294; &#xC5B4;&#xB5A4;&#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB97C; Static link&#xB85C; &#xC0AC;&#xC6A9;&#xD560;&#xC9C0; &#xAC15;&#xC81C;&#xD558;&#xC9C0;&#xB294; &#xC54A;&#xB294;&#xB2E4;. &#xC6B0;&#xB9AC;&#xB294; &#xC774; &#xD29C;&#xD1A0;&#xB9AC;&#xC5BC;&#xC5D0;&#xC11C; <code>r10</code>&#xC744; &#xC0AC;&#xC6A9;&#xD560; &#xAC83;&#xC774;&#xB2E4;.  </p>
<p>Static Link&#xB97C; setting&#xD560;&#xB54C;&#xC5D0;&#xB294; &#xB2E4;&#xC74C;&#xC758; &#xB450;&#xAC00;&#xC9C0; &#xCF00;&#xC774;&#xC2A4;&#xB97C; &#xACE0;&#xB824;&#xD574;&#xC57C; &#xD55C;&#xB2E4;. </p>
<ul>
<li>Nesting depth 1<br>  &#xC608;&#xC81C; 1</li>
<li>Nesting depth 2 &#xC774;&#xC0C1;<br>  &#xC608;&#xC81C; 2</li>
</ul>
<p>&#xC790;, &#xADF8;&#xB7FC; &#xC774;&#xC81C; &#xC608;&#xC81C;2 &#xB294; &#xC5B4;&#xB5BB;&#xAC8C; assembly&#xB85C; &#xAD6C;&#xD604;&#xD558;&#xB294;&#xC9C0; &#xC0B4;&#xD3B4; &#xBCF4;&#xC790;.<br>&#xD575;&#xC2EC;&#xC740; caller&#xAC00; &#xD638;&#xCD9C;&#xD560; callee&#xC758; Static Link&#xB97C; &#xCC3E;&#xC544;&#xC11C; <code>r10</code>&#xC5D0; &#xB123;&#xC5B4;&#xC8FC;&#xACE0; &#xD638;&#xCD9C;&#xD55C;&#xB2E4;&#xB294; &#xAC83;&#xC774;&#xB2E4;. &#xADF8; Static Link&#xB294; &#xB2E8;&#xC21C;&#xD788; caller&#xC758; <code>fp</code>&#xAC00; &#xC544;&#xB2D0;&#xC218; &#xC788;&#xC74C;&#xC744; &#xC704;&#xC5D0;&#xC11C; &#xC124;&#xBA85;&#xD558;&#xC600;&#xB2E4;.   </p>
<p><strong>&#xC9C0;&#xAE08;&#xBD80;&#xD130; &#xB098;&#xC62C; assembly &#xC608;&#xC81C;&#xB4E4;&#xC758; &#xC8FC;&#xC11D;&#xC744; &#xAF3C;&#xAF3C;&#xD788; &#xC0B4;&#xD3B4;&#xBCF4;&#xC790;.</strong>  </p>
<h4 id="&#xD568;&#xC218;-f">&#xD568;&#xC218; f()</h4>
<pre><code class="lang-asm">f:
    push {r4, r10, fp, lr} /* keep registers */
    mov fp, sp             /* setup dynamic link */

    sub sp, sp, #8      /* make room for x (4 + 4 bytes) */
    /* x will be in address &quot;fp - 4&quot; */

    /* At this point our stack looks like this

     Data | Address | Notes
    ------+---------+---------------------------
          | fp - 8  | alignment (per AAPCS)
      x   | fp - 4  | 
      r4  | fp      |  
      r10 | fp + 8  | previous value of r10
      fp  | fp + 12 | previous value of fp
      lr  | fp + 16 |
   */

    mov r4, #1          /* r4 &#x2190;  1 */
    str r4, [fp, #-4]   /* x &#x2190;  r4 */

    /* prepare the call to h */
    mov r10, fp /* setup the static link,
                   since we are calling an immediately nested function
                   it is just the current frame */
    bl h        /* call h */

    mov sp, fp             /* restore stack */
    pop {r4, r10, fp, lr}  /* restore registers */
    bx lr /* return */
</code></pre>
<blockquote>
<p>&#xD568;&#xC218; f&#xB294; nested&#xB418;&#xC9C0; &#xC54A;&#xC558;&#xAE30; &#xB54C;&#xBB38;&#xC5D0;  <code>mov r10, fp</code> &#xC5EC;&#xAE30;&#xC11C; &#xC774;&#xB3D9;&#xC791;&#xC740; &#xD070; &#xC758;&#xBBF8;&#xAC00; &#xC5C6;&#xB2E4;.  </p>
</blockquote>
<h4 id="&#xD568;&#xC218;-h">&#xD568;&#xC218; h()</h4>
<pre><code class="lang-asm">h :
    push {r4, r5, r10, fp, lr} /* keep registers */
    mov fp, sp /* setup dynamic link */

    sub sp, sp, #4 /* align stack */

    /* At this point our stack looks like this

      Data | Address | Notes
     ------+---------+---------------------------
           | fp - 4  | alignment (per AAPCS)
       r4  | fp      |  
       r5  | fp + 4  | 
       r10 | fp + 8  | frame pointer of &apos;f&apos;
       ^^^             ^^^^^^^^^^^^^^^^^^^^
       fp  | fp + 12 | frame pointer of caller
       lr  | fp + 16 |
    */

    /* g&#xB294; h&#xC640; &#xD615;&#xC81C;&#xC774;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; h&#xC758; static link&#xC640; &#xB3D9;&#xC77C;&#xD558;&#xB2E4;. */
    ldr r10, [fp, #8]
    ^^^^^^^^^^^^^^^^^
    bl g

    /* m&#xC740; h&#xD568;&#xC218; &#xB0B4;&#xC5D0;&#xC11C; nested&#xB418;&#xC5B4;&#xC788;&#xB2E4;. &#xB530;&#xB77C;&#xC11C; m&#xC758; static link&#xB294; &#xD604;&#xC7AC; fp&#xC640; &#xB3D9;&#xC77C;&#xD558;&#xB2E4; */
    mov r10, fp
    ^^^^^^^^^^^
    bl m

    ldr r4, [fp, #8]  /* load frame pointer of &apos;f&apos; */
    ^^^^^^^^^^^^^^^^
    ldr r5, [r4, #-4]  /* r5 &#x2190;  x */
                         ^^^^^^^^^
    add r5, r5, #3     /* r5 &#x2190;  r5 + 3 */
    str r5, [r4, #-4]  /* x &#x2190;  r5 */

    mov sp, fp            /* restore stack */
    pop {r4, r5, r10, fp, lr} /* restore registers */
    bx lr
</code></pre>
<blockquote>
<ul>
<li>g &#xC758; static link r10&#xC5D0; &#xC800;&#xC7A5; <code>ldr r10, [fp, #8]</code>  </li>
<li>m &#xC758; static link r10&#xC5D0; &#xC800;&#xC7A5; <code>mov r10, fp</code>  </li>
<li>h &#xC5D0;&#xC11C; f&#xC758; local &#xBCC0;&#xC218; &#xC5BB;&#xAE30;:<br> <code>ldr r4, [fp, #8]</code>  /<em> load frame pointer of &apos;f&apos; </em>/<br> <code>ldr r5, [r4, #-4]</code> : &#xACB0;&#xAD6D; f&#xC758; &#xB85C;&#xCEEC;&#xBCC0;&#xC218;&#xB97C; &#xC5BB;&#xC5B4;&#xC634;
 &#xC5EC;&#xAE30;&#xC11C; &#xD615;&#xC81C;(Sibling)&#xC758; &#xC758;&#xBBF8;&#xB294; Nesting depth&#xAC00; &#xB3D9;&#xC77C;&#xD558;&#xB2E4;&#xB294;&#xAC83;&#xC744; &#xB9D0;&#xD55C;&#xB2E4;.  </li>
</ul>
</blockquote>
<p>&#xC911;&#xCCA9;&#xB41C; nested &#xD568;&#xC218;&#xC758; &#xACBD;&#xC6B0;, &#xB2E8;&#xC21C;&#xD788; <a href="#&#xC608;&#xC81C;%201">&#xC608;&#xC81C; 1</a> &#xCC98;&#xB7FC; <code>fp</code>&#xB97C; &#xC774;&#xC6A9;&#xD558;&#xB294; &#xAC83;&#xC774; &#xC544;&#xB2C8;&#xB2E4;. <code>r10</code> &#xC744; &#xC774;&#xC6A9;&#xD574;&#xC11C; static link&#xB97C; &#xBBF8;&#xB9AC; &#xACC4;&#xC0B0;&#xD574;&#xC11C; &#xC804;&#xB2EC;&#xD558;&#xB294; &#xC774;&#xC720;&#xB294; call&#xD558;&#xB294; &#xD568;&#xC218;&#xB9C8;&#xB2E4; static link&#xB97C; &#xB2E4;&#xB974;&#xAC8C; &#xACC4;&#xC0B0; &#xD574; &#xC8FC;&#xC5B4;&#xC57C; &#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC774;&#xB2E4;. &#xC704; &#xC608;&#xC81C;&#xC5D0;&#xC11C; m()&#xACFC; g()&#xB294; static link&#xAC00; &#xB2E4;&#xB974;&#xB2E4;. &#xD568;&#xC218; &#xB0B4;&#xC5D0;&#xC11C; fp&#xB97C; &#xD1B5;&#xD574; &#xACC4;&#xC0B0;&#xD560;&#xC218; &#xC788;&#xC9C0;&#xB9CC; &#xADF8;&#xB7EC;&#xBA74; &#xBCF5;&#xC7A1;&#xD574;&#xC9C8; &#xAC83;&#xC774;&#xB2E4;. &#xBBF8;&#xB9AC; <code>r10</code> &#xC5D0; &#xACC4;&#xC0B0;&#xD558;&#xC5EC; &#xC804;&#xB2EC;&#xD574;&#xC8FC;&#xB294;&#xAC83;&#xACFC; &#xAC19;&#xB2E4;.  </p>
<h4 id="&#xD568;&#xC218;-m">&#xD568;&#xC218; m()</h4>
<pre><code class="lang-asm">m:
    push {r4, r5, r10, fp, lr} /* keep registers */
    mov fp, sp /* setup dynamic link */

    sub sp, sp, #4 /* align stack */
    /* At this point our stack looks like this

      Data | Address | Notes
     ------+---------+---------------------------
           | fp - 4  | alignment (per AAPCS)
       r4  | fp      |  
       r5  | fp + 4  |
       r10 | fp + 8  | frame pointer of &apos;h&apos;
       ^^^             ^^^^^^^^^^^^^^^^^^^^
       fp  | fp + 12 | frame pointer of caller
       lr  | fp + 16 |
    */

    ldr r4, [fp, #8]  /* r4 &#x2190;  frame pointer of &apos;h&apos; */
    ^^^^^^^^^^^^^^^^
    ldr r4, [r4, #8]  /* r4 &#x2190;  frame pointer of &apos;f&apos; */
    ^^^^^^^^^^^^^^^^
    ldr r5, [r4, #-4] /* r5 &#x2190;  x */
    add r5, r5, #2    /* r5 &#x2190;  r5 + 2 */
    str r5, [r4, #-4] /* x &#x2190;  r5 */

    /* setup call to g */
    ldr r10, [fp, #8]   /* r10 &#x2190;  frame pointer of &apos;h&apos; */
    ^^^^^^^^^^^^^^^^^
    ldr r10, [r10, #8]  /* r10 &#x2190;  frame pointer of &apos;f&apos; */
    ^^^^^^^^^^^^^^^^^^
    bl g

    mov sp, fp                /* restore stack */
    pop {r4, r5, r10, fp, lr} /* restore registers */
    bx lr
</code></pre>
<blockquote>
<p><code>ldr r4, [fp, #8]</code> : h&#xC758; &#xD504;&#xB808;&#xC784;&#xD3EC;&#xC778;&#xD130;<br><code>ldr r4, [r4, #8]</code> : &#xB97C; &#xC774;&#xC6A9;&#xD574; f &#xD504;&#xB808;&#xC784;&#xD3EC;&#xC778;&#xD130;&#xB97C; &#xC5BB;&#xC5B4;&#xC634;<br>&#xD568;&#xC218; m()&#xB0B4;&#xC5D0;&#xC11C; &#xD638;&#xCD9C;&#xB418;&#xB294; <strong>g() &#xC758; static link&#xB294; f&#xC758; fp</strong>&#xC774;&#xB77C;&#xB294;&#xC810;&#xC774; &#xC911;&#xC694;&#xD558;&#xB2E4;. &#xADF8; &#xB54C;&#xBB38;&#xC5D0; &#xD638;&#xCD9C;&#xD558;&#xAE30; &#xC804;&#xC5D0; &#xC704;&#xC640; &#xAC19;&#xC774; &#xACC4;&#xC0B0;&#xD568;.<br>g()&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; caller&#xAC00; m()&#xC774;&#xB77C;&#xACE0; &#xD558;&#xB354;&#xB77C;&#xB3C4; g()&#xC758; static link&#xB294; f()&#xC784;&#xC5D0; &#xC8FC;&#xC758;  </p>
</blockquote>
<h4 id="&#xD568;&#xC218;-g">&#xD568;&#xC218; g()</h4>
<pre><code class="lang-asm">g:
    push {r4, r5, r10, fp, lr} /* keep registers */
    mov fp, sp /* setup dynamic link */

    sub sp, sp, #4 /* align stack */

    /* At this point our stack looks like this

      Data | Address | Notes
     ------+---------+---------------------------
           | fp - 4  | alignment (per AAPCS)
       r4  | fp      |  
       r5  | fp + 4  |  
       r10 | fp + 8  | frame pointer of &apos;f&apos;
       ^^^             ^^^^^^^^^^^^^^^^^^^^
       fp  | fp + 12 | frame pointer of caller
       lr  | fp + 16 |
    */

    ldr r4, [fp, #8]  /* r4 &#x2190;  frame pointer of &apos;f&apos; */
    ^^^^^^^^^^^^^^^^
    ldr r5, [r4, #-4] /* r5 &#x2190;  x */
    ^^^^^^^^^^^^^^^^^
    add r5, r5, #1    /* r5 &#x2190;  r5 + 1 */
    str r5, [r4, #-4] /* x &#x2190;  r5 */

    mov sp, fp /* restore dynamic link */
    pop {r4, r5, r10, fp, lr} /* restore registers */
    bx lr
</code></pre>
<blockquote>
<p>h&#xC640; &#xBE44;&#xC2B7;&#xD558;&#xB098;, &#xB530;&#xB85C; &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xC9C0;&#xB294; &#xC54A;&#xB294;&#xB2E4;. 
g&#xC640; h&#xB294; nesting depth&#xAC00; &#xB3D9;&#xC77C;&#xD568;.  </p>
</blockquote>
<p>&#xC9C0;&#xAE08;&#xAE4C;&#xC9C0; &#xC0B4;&#xD3B4;&#xBCF8; &#xC608;&#xC81C; &#xCF54;&#xB4DC;&#xB294; &#xBAA8;&#xB450; fp + 8 &#xB85C;, static link&#xB97C; &#xC5BB;&#xC5B4;&#xC654;&#xC9C0;&#xB9CC;, &#xD56D;&#xC0C1; &#xADF8;&#xB7F0;&#xAC83;&#xC740; &#xC544;&#xB2C8;&#xB2E4;. Caller&#xAC00; r10&#xC744; push &#xD558;&#xAE30;&#xC804;&#xC5D0;  &#xC5BC;&#xB9C8;&#xB098; &#xB9CE;&#xC740; register&#xB97C; push&#xD588;&#xB294;&#xC9C0;&#xC5D0; &#xB530;&#xB77C; &#xB2EC;&#xB77C;&#xC9C8; &#xC218; &#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC774;&#xB2E4;.  </p>
<p>&#xB9C8;&#xC9C0;&#xB9C9;&#xC73C;&#xB85C; f()&#xB97C; &#xD638;&#xCD9C;&#xD558;&#xB294; main &#xD568;&#xC218;&#xB294; &#xC544;&#xB798;&#xC640; &#xAC19;&#xB2E4;.  </p>
<pre><code class="lang-asm">.globl main

main :
    push {r4, lr} /* keep registers */

    bl f          /* call f */

    mov r0, #0
    pop {r4, lr}
    bx lr
</code></pre>
<blockquote>
<p>nested &#xB418;&#xC9C0; &#xC54A;&#xC740; &#xD568;&#xC218;&#xAC00; &#xB610;&#xB2E4;&#xB978; non-nested &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD560;&#xB54C;&#xB294; r10&#xC5D0; &#xC5B4;&#xB5A4;&#xAC83;&#xB3C4; &#xD560; &#xD544;&#xC694;&#xAC00; &#xC5C6;&#xB2E4;.  </p>
</blockquote>
<h2 id="&#xD55C;&#xACC4;">&#xD55C;&#xACC4;</h2>
<p>&#xC2E4;&#xC81C;&#xB85C; r10&#xC740; &#xD568;&#xC218;&#xB0B4;&#xC5D0;&#xC11C; &#xC0AC;&#xC6A9;&#xB418;&#xAC70;&#xB098; &#xBCC0;&#xACBD;&#xB418;&#xC9C0; &#xC54A;&#xC558;&#xB2E4;. &#xADF8;&#xB7F0;&#xB370; &#xC65C; stack&#xC5D0; push&#xD558;&#xB294;&#xAC00;?<br>&#xB3D9;&#xC77C;&#xD55C; &#xD568;&#xC218; scope&#xC5D0; &#xC704;&#xCE58;&#xD574;&#xC57C;&#xD558;&#xAE30; &#xB54C;&#xBB38;&#xC774;&#xB2E4;? &#xC774;&#xAC83;&#xC744; Lexical scope&#xB77C;&#xACE0; &#xBD80;&#xB978;&#xB2E4;. static link&#xAC00; &#xC11C;&#xB85C; chaining&#xB418;&#xC5B4;&#xC788;&#xAE30; &#xB54C;&#xBB38;&#xC5D0; &#xAC01;&#xAC01;&#xC758; lexical scope&#xB85C; &#xC774;&#xB3D9;&#xD560; &#xC218; &#xC788;&#xB2E4;.  </p>
<p><code>&#xCC38;&#xACE0;: Lexical scope</code>
C/C++, Java, &#xADF8;&#xB9AC;&#xACE0; JavaScript &#xAC19;&#xC774; &#xC6B0;&#xB9AC;&#xAC00; &#xC811;&#xD558;&#xB294; &#xB300;&#xBD80;&#xBD84;&#xC758; &#xC5B8;&#xC5B4;&#xB4E4;&#xC740; Lexical Scope&#xB97C; &#xC0AC;&#xC6A9;&#xD55C;&#xB2E4;. Lexical Scope&#xB294; Static Scope&#xB77C;&#xACE0;&#xB3C4; &#xBD88;&#xB9B0;&#xB2E4;. Scope&#xAC00; &#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB420;&#xB54C;&#xAC00; &#xC544;&#xB2C8;&#xB77C; &#xC815;&#xC758;&#xB420;&#xB54C; &#xC0DD;&#xAE34;&#xB2E4;&#xB294; &#xB73B;&#xC774;&#xB2E4;. Lexical Scope&#xB294; &#xBCC0;&#xC218;&#xB098; &#xD568;&#xC218;&#xAC00; &#xC815;&#xC758; &#xB41C; &#xACF3;&#xC758; context&#xB97C; &#xC0AC;&#xC6A9;&#xD558;&#xBA70;, Dynamic Scope&#xB294; &#xBCC0;&#xC218;&#xB098; &#xD568;&#xC218;&#xAC00; &#xBD88;&#xB824;&#xC9C4; &#xACF3;&#xC758; context&#xB97C; &#xC0AC;&#xC6A9;&#xD55C;&#xB2E4;.<br><strong>Lexical scope</strong>: use environment where function [and variable] is <strong>defined</strong><br><strong>Dynamic scope</strong>: use environment where function [and variable] is <strong>called</strong>  </p>
<p>&#xCD9C;&#xCC98;: <a href="https://bestalign.github.io/2015/07/12/Lexical-Scope-and-Dynamic-Scope/" target="_blank">https://bestalign.github.io/2015/07/12/Lexical-Scope-and-Dynamic-Scope/</a>  </p>
<p>callee&#xAC00; r10&#xC744; stack&#xC5D0; push &#xD558;&#xB294;&#xB300;&#xC2E0;&#xC5D0; caller&#xAC00; stack&#xC5D0; push&#xD558;&#xB294; &#xBC29;&#xC2DD;&#xC73C;&#xB85C; parameter&#xB85C; &#xC804;&#xB2EC;&#xD560; &#xC218;&#xB3C4; &#xC788;&#xB2E4;. &#xB610;&#xD55C; &#xBB3C;&#xB860; r0 ~ r3&#xB808;&#xC9C0;&#xC2A4;&#xD130;&#xB85C; &#xC778;&#xC790;&#xB97C; &#xC804;&#xB2EC; &#xD560; &#xC218;&#xB3C4; &#xC788;&#xB2E4;. &#xB300;&#xC2E0;&#xC5D0; &#xADF8;&#xB7EC;&#xBA74; &#xB0B4;&#xBD80;&#xC5D0;&#xC11C; stack&#xC5D0; &#xB2E4;&#xC2DC; push&#xD574;&#xC918;&#xC57C;&#xD55C;&#xB2E4;.   </p>
<p>&#xACB0;&#xAD6D; static link&#xB294; &#xD56D;&#xC0C1; stack&#xC5D0; &#xC800;&#xC7A5;&#xD574;&#xC57C;&#xD55C;&#xB2E4;&#xB294; &#xC758;&#xBBF8;&#xB2E4;.  </p>
<p>&#xADF8;&#xB7F0;&#xB370; &#xB9CC;&#xC57D; static link&#xB97C; &#xC774;&#xC6A9;&#xD574; &#xC811;&#xADFC;&#xD574;&#xC57C;&#xD560; &#xB85C;&#xCEEC; &#xBCC0;&#xC218;&#xAC00;  pointer &#xB77C;&#xBA74; &#xC5B4;&#xB5BB;&#xAC8C; &#xD574;&#xC57C;&#xD558;&#xB098;?
&#xC9C0;&#xAE08;&#xAE4C;&#xC9C0; &#xC608;&#xC81C;&#xC5D0;&#xC11C; &#xC6B0;&#xB9AC;&#xB294; &#xC5B4;&#xB5A4; &#xC704;&#xCE58; &#xC5B4;&#xB5A4; &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD574;&#xC57C;&#xD560;&#xC9C0; &#xBBF8;&#xB9AC; &#xB2E4; &#xC54C;&#xACE0;&#xC788;&#xC5C8;&#xB2E4;. &#xB9CC;&#xC57D; Indirect call&#xB85C; &#xD568;&#xC218;&#xB97C; &#xD638;&#xCD9C;&#xD560;&#xB54C;&#xB294; &#xC5B4;&#xB5BB;&#xAC8C; &#xB418;&#xB294;&#xAC00;? &#xC6B0;&#xB9AC;&#xB294; &#xC5B4;&#xB5A4; nested&#xD568;&#xC218;&#xAC00; &#xD638;&#xCD9C;&#xB420;&#xC9C0; &#xBBF8;&#xB9AC; &#xC54C;&#xC9C0; &#xBABB;&#xD558;&#xBA70; lexical socope&#xB97C; &#xC5B4;&#xB5BB;&#xAC8C; &#xC124;&#xC815;&#xD560;&#xC9C0;&#xB3C4; &#xBAA8;&#xB978;&#xB2E4;. &#xACB0;&#xAD6D; lexical sopce&#xB97C; &#xC5B4;&#xB518;&#xAC00;&#xC5D0; &#xC720;&#xC9C0;&#xD558;&#xC9C0; &#xC54A;&#xB294;&#xC774;&#xC0C1; &#xBABB;&#xD55C;&#xB2E4;.    </p>
<p>This means that just the address of the function will not do. We will need to keep, along with the address to the function, the lexical scope.
So a pointer to a nested function happens to be different to a pointer to a non-nested function, given that the latter does not need the lexical scope to be set.</p>
<p>&#xB2E4;&#xC74C; &#xCC55;&#xD130;&#xC5D0;&#xC11C;&#xB294; non-nested&#xD568;&#xC218;&#xC640; &#xD3EC;&#xC778;&#xD130;&#xAC00; &#xB2E4;&#xB978; &#xC11C;&#xB85C;&#xB2E4;&#xB978; &#xD568;&#xC218;&#xB4E4;&#xC758; &#xD3EC;&#xC778;&#xD130;&#xB97C; &#xAC16;&#xB294;&#xAC83;&#xC744; &#xD53C;&#xD558;&#xB294; &#xBC29;&#xBC95;&#xC5D0; &#xB300;&#xD574; &#xC54C;&#xC544;&#xBCF4;&#xC790; (?)</p>
<p>Having incompatible pointers for nested an non nested functions is not desirable. This may be a reason why C (and C++) do not directly support nested functions (albeit this limitation can be worked around using other approaches). In the next chapter, we will see a clever approach to avoid, to some extent, having different pointers to nested functions that are different from pointers to non nested functions. (<del>?&#xBB34;&#xC2A8;&#xB9D0;&#xC778;&#xC9C0; &#xBAA8;&#xB974;&#xACA0;&#xC74C;</del>)</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="22-The-Thumb-instruction-set.html" class="navigation navigation-prev " aria-label="Previous page: 22. The Thumb instruction set">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="24-Trampolines.html" class="navigation navigation-next " aria-label="Next page: 24. Trampolines">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"23. Nested functions","level":"2.23","depth":1,"next":{"title":"24. Trampolines","level":"2.24","depth":1,"path":"markdowns/24-Trampolines.md","ref":"markdowns/24-Trampolines.md","articles":[]},"previous":{"title":"22. The Thumb instruction set","level":"2.22","depth":1,"path":"markdowns/22-The-Thumb-instruction-set.md","ref":"markdowns/22-The-Thumb-instruction-set.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{"BASE_URL":"http://soopsaram.com/assembly"},"plugins":["ga","simple-page-toc","disqus","back-to-top-button","edit-link","github","livereload"],"pluginsConfig":{"disqus":{"useIdentifier":false,"shortName":"jihuun"},"github":{"url":"https://github.com/jihuun/assembly"},"livereload":{},"simple-page-toc":{"maxDepth":2,"skipFirstH1":true},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"back-to-top-button":{},"ga":{"configuration":"auto","token":"UA-145847458-1"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit","base":"https://github.com/jihuun/assembly/edit/master"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"markdowns/23-Nested-functions.md","mtime":"2019-08-15T13:33:21.604Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-08-16T11:29:56.608Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

